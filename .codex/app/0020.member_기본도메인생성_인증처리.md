# member 기본 도메인 생성 및 인증 처리

## 변경사항 기록
- 0020.member_기본도메인생성_인증처리.md: 신규 문서 생성.

## 히스토리 (대화/실험 로그를 기록하세요.)
- member 도메인 모델 `Member`와 enum `MemberRole`, `MemberStatus`를 추가했다.
- JWT 설정을 추가하고 `JwtProperties`, `JwtTokenProvider`, `JwtAuthenticationFilter`를 생성했다.
- `JwtProperties`를 제거하고 `JwtTokenProvider`에서 `application.yml` 값을 직접 주입하도록 변경했다.
- `/api/auth/refresh` 엔드포인트와 요청/응답 모델을 추가했다.
- `SecConfig`에서 JWT 필터와 인증 정책을 구성했다.
- `war/src/main/resources/application.yml`에 JWT 설정을 추가했다.
- `war/src/main/resources/application.yml`에서 `access-header`, `bearer-prefix` 설정을 제거했다.
- JWT 설정 키를 `access`, `refresh`로 변경했다.
- JWT 관련 식별자 표기를 `userid`로 통일했다.
- `AppConfig`에 `ObjectMapper` 빈을 추가했다.
- `ObjectMapper` 생성 방식을 `jacksonObjectMapper()`로 변경했다.
- 로그인/로그아웃 유스케이스와 JPA 기반 조회, BCrypt 검증을 추가했다.
- 토큰 발행 시 `member_token` 테이블에 access/refresh를 저장하도록 추가했다.
- refresh 토큰은 최소 정보(Subject)만 담도록 변경하고 재발급 시 DB에서 사용자 정보를 조회한다.
- refresh 시 DB의 refresh 토큰과 일치하지 않으면 예외 처리하도록 변경했다.
- 로그인/리프레시 유스케이스에 트랜잭션을 적용했다.
- `MemberTokenRepository`를 Command/Query로 분리했다.
- 모든 컨트롤러 응답을 `ResponseEntity<ApiResponse<...>>` 형태로 통일했다.
- `ApiResponse.success()`의 재귀 호출 버그를 수정했다.
- `ApiResponse`의 기본값과 팩토리 메서드를 일관되게 정리했다.

## 최종 프롬프트
너는 `zod-app`의 member 도메인과 인증 처리를 담당하는 지원자다. 다음을 준수한다.
- `/AGENTS.md`와 `/app/AGENTS.md`를 읽고 따른다.
- 도메인 분리는 패키지 단위이며, member 관련 설계/구현은 `zod.member` 하위에 둔다.
- 헥사고날 아키텍처와 CQRS를 따른다.
- 계층 책임을 준수한다: `domain`(규칙/모델), `application`(유스케이스 조합), `infra`(기술 구현), `api`(입출력 변환/요청 위임).
- 파일 수정/코드 생성은 명시적 요청이 있을 때만 수행한다.
- 기본 모드는 구조 검토, 설계 피드백, 문제점 지적이다.
- 정보가 부족하면 임의로 추론하지 말고 질문한다.
- 설계 의도 확인 없이 아키텍처/책임 분리/패키지 구조를 변경하지 않는다.
- 인증/인가 정책은 전역 보안 정책과의 경계를 유지하고, 도메인 책임을 침범하지 않는다.
